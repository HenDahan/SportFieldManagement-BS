pipeline {
    RED='\033[0;31m'
    CYAN='\e[36m'
    BLUE='\e[34m'
    agent{
        docker {
            image 'windsekirun/jenkins-android-docker:1.1.1'
        }
    }
    options {
        skipStagesAfterUnstable()
    }
    stages{
        stage("Pre build stage:") {
            steps{
                echo "starting pre build stage"
                sh "chmod +x ./gradlew"
                echo -e "${RED}grant permission gradle.${RED}"
            }
        }
        stage('Compiling stage:') {
            steps {
                echo -e "${BLUE}starting pre build stage.${BLUE}"
                sh './gradlew compileDebugSources'
                echo -e "${RED}compiling succeed.${RED}"
            }
        }
        stage('Unit test stage:') {
            steps {
                 echo -e "${BLUE}starting the unit tests stage.${BLUE}"
                sh './gradlew testDebugUnitTest testDebugUnitTest' 
                echo -e "${RED}unitTesting succeed.${RED}"
            }
        }
        stage('Build APK') {
          steps {
            sh './gradlew assembleDebug'
            //archiveArtifacts '**/*.apk'
          }
    }
        stage('Finished'){
            steps {
                echo -e "${CYAN}Jenkins tests on the Git project finished running succesfully!${CYAN}'
            }
        }
        stage('Email notification stage:') {
           steps{
               echo -e "${YELLOW}email notification stage.${YELLOW}'
                    }
                    post {
                        success {
                        mail to: 'kfir.rn@gmail.com', subject: 'Build ', body: "Build ${env.BUILD_NUMBER} successfully worked; ${env.BUILD_URL}"
                        }
                    }
                }
            }
                    post {
                        failure {
                        mail to: 'kfir.rn@gmail.com', subject: 'Something went wrong, build.', body: "${env.BUILD_NUMBER} failed; ${env.BUILD_URL}"
         }
        stage('Verifing file') {
           steps{
                echo -e "${YELLOW}verifing file.${YELLOW}"
                    }
                    post {
                        success {
                            def exist = fileExists 'Jenkinsfile'
                            if (exist){
                                echo "yes"
                            }
                            else{
                                echo "no"
                            }
                        }
                    }
                }
            }
                    post {
                        failure {
                        eccho "build failed"
                        }      
        }
}
