pipeline {
    agent{
        docker {
            image 'windsekirun/jenkins-android-docker:1.1.1'
        }
    }
    options {
        skipStagesAfterUnstable()
    }
    stages{
        stage("Pre build stage:") {
            steps{
                echo "starting pre build stage"
                sh "chmod +x ./gradlew"
                echo "grant permission gradle."
            }
        }
        stage('Compiling stage:') {
            steps {
                echo "starting pre build stage."
                sh './gradlew compileDebugSources'
                echo "compiling succeed."
            }
        }
        stage('Unit test stage:') {
            steps {
                echo "starting the unit tests stage."
                sh './gradlew testDebugUnitTest testDebugUnitTest' 
                echo "unitTesting succeed."
            }
        }
        stage('Build APK') {
          steps {
            sh './gradlew assembleDebug'
            //archiveArtifacts '**/*.apk'
            }
        }
        stage('Finished'){
            steps {
                echo "Jenkins tests on the Git project finished running succesfully!"
            }
        }
        stage('Email notification stage:') {
           steps{
               echo "email notification stage."
                    }
                    post {
                        success {
                        mail to: "kfir.rn@gmail.com", subject: "Build ", body: "Build ${env.BUILD_NUMBER} successfully worked; ${env.BUILD_URL}"
                        }
                    }
                    post {
                        failure {
                        mail to: "kfir.rn@gmail.com", subject: "Something went wrong, build.", body: "${env.BUILD_NUMBER} failed; ${env.BUILD_URL}"
                        }
                    }
                }
            }
        stage('Verifing file') {
           steps{
               echo "verifing file."
               script{                   
                    def exist = fileExists 'Jenkinsfile'
                    if (exist){
                        echo "yes"
                    }
                    else{
                        echo "no"
                    }
               }
            } 
        }
    }
}
