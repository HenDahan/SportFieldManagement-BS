pipeline {
    agent{
        docker {
            image 'windsekirun/jenkins-android-docker:1.1.1'
        }
    }
    options {
        skipStagesAfterUnstable()
    }
    stages{
        stage("Pre build stage:") {
            steps{
                echo "starting pre build stage"
                sh "chmod +x ./gradlew"
                echo "grant permission gradle."
            }
        }
        
        stage('Compiling stage:') {
            steps {
                echo "starting pre build stage."
                sh './gradlew compileDebugSources'
                echo "compiling succeed."
            }
        }
        
        stage('Unit test stage:') {
            steps {
                echo "starting the unit tests stage."
                sh './gradlew testDebugUnitTest testDebugUnitTest' 
                echo "unitTesting succeed."
            }
        }

        stage('Finished'){
            steps {
                echo "Jenkins tests on the Git project finished running succesfully!"
            }
        }
        
        stage('Measurment - Verifing working space file') {
            steps{
               echo "verifing working space file."
               script{                   
                    def exist = fileExists '/var/jenkins_home/workspace/Team_12/Git_pipeline_Team-12'
                    if (exist){
                        echo "the file exist."                        
                        echo "the working space is: ${WORKSPACE}"
                    }
                    else{
                        echo "the file does not exist."
                        echo "the working space is: ${WORKSPACE}"
                    }
                }
            }
        }

        stage('Measurment - Email notification stage') {
           steps{
               echo "email notification stage."
            }
            post {
                success {
                    mail to: "kfir.rn@gmail.com", subject: "Build ", body: "Build ${env.BUILD_NUMBER} successfully worked; ${env.BUILD_URL}"
                }
            }
        }
    }
    stages{
        stage('Measurment - build status check') {
            steps{
                post {
                    failure {
                        mail to: "kfir.rn@gmail.com", subject: "Build ", body: "Build ${env.BUILD_NUMBER} failed; ${env.BUILD_URL}"
                    }
                }
            }
        }
    }
}

